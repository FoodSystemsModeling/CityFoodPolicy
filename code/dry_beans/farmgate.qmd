---
title: "01.Farm gate pricing"
format: html
editor: visual
---

In this file, we pull data needed for the beans model input, not including data pulled using the restricted access census of agriculture data. We pull price data from NASS and use the data we collected on dry bean producers from the restricted access Census of Agriculture.

## Cost of production

We use the NASS defined variable, total expense, which includes all production expenses listed in the production expense section of the census and includes both fixed and variable expenses. Data are pulled for producers with dry bean sales. However, these data are at the whole farm level. We do not know the cost of production of beans specifically. 

To understand cost of production for New York bean producers, we use data from interviews conducted of New York bean producers, which estimate a cost of production of $500 per acre.  

We also need a cost of production for bean producers outside of New York, as those are the producers currently supplying the New York City beans. Based on discussions with Michael, most of the beans come from North Dakota, so we base our cost of production on an enterprise budget from North Dakota. We also include the other crop budgets we could find for comparison/to provide range: 

-   [North Dakota, 2024](https://www.ndsu.edu/agriculture/sites/default/files/2024-02/2024%20North%20East%20ND%20Projected%20Crop%20Budget%20-%20PDF.pdf)
    -   Cost per acre: \$434.05
-   [Wyoming](https://wyoextension.org/publications/html/B1315-2/)
    -   Cost per acre: \$598.70, cost per CWT \$23.95
-   [Colorado](https://abm.extension.colostate.edu/enterprise-budgets-crop/)
    -   Cost per acre: \$454.57, cost per CWT \$113.64
-   [Texas](https://aggie-horticulture.tamu.edu/smallacreage/crops-guides/vegtables/dry-beans/)
    -   Cost per acre: \$400


**Conclusions** 
We will use the cost of production data from New York combined with Census of Agriculture data to estimate cost of production for different types of operations. For those outside of NY, we will provide a range based on the enterprise budgets we were able to find. 

From the Census of Agriculture, we have an average dry bean yield in NY of 20.5 CWT per acre to convert to production cost per lb.

The New York cost of production per acre is based on June's assumption. 

### NYS producers
```{r}
library(tidyverse)
library(readxl)

ny_production_cost_acre <- 525
ny_production_cost_acre_se <- 0.25*ny_production_cost_acre

# Import fake data
production_cost <- read_xlsx(
  "../data_processed/coa_cost_per_acre_fake.xlsx", 
  sheet = "drybeans")

# Add production cost per acre for beans from crop budget
production_cost <- production_cost %>% 
  mutate(
    year = 2024,
    baseline = ny_production_cost_acre, 
    baseline_se = ny_production_cost_acre_se,
    production_cost_acre_mean = baseline + 
      (baseline*percent_diff_mean), 
    production_cost_acre_se =  baseline_se + 
      (baseline_se*percent_diff_se) 
    )

# Rename to be consistent with other spreadsheet
production_cost <- production_cost %>% 
  mutate(
    variable_name = case_when(
      mwbe_fct=="Not MWBE" & 
        sales_class_agg == "GCFI $1M or more" & 
        organic_fct == "No organic sales" ~ 
        "cost_of_production_drybean_more_mill_nonmwbe_conv", 
      mwbe_fct=="MWBE" & 
        sales_class_agg == "GCFI $1M or more" & 
        organic_fct == "No organic sales" ~
      "cost_of_production_drybean_more_mill_mwbe_conv",
      mwbe_fct=="Not MWBE" & 
        sales_class_agg == "GCFI less than $1M" & 
        organic_fct == "No organic sales" ~ 
        "cost_of_production_drybean_less_mill_nonmwbe_conv", 
      mwbe_fct=="MWBE" & 
        sales_class_agg == "GCFI less than $1M" & 
        organic_fct == "No organic sales" ~ 
        "cost_of_production_drybean_less_mill_mwbe_conv", 
      mwbe_fct=="Not MWBE" & 
        sales_class_agg == "GCFI less than $1M" & 
        organic_fct == "Organic sales" ~
        "cost_of_production_drybean_less_mill_nonmwbe_org")
  ) 

# Keep only data we need
production_cost <- production_cost %>% 
  select(variable_name,
         production_cost_acre_mean, production_cost_acre_se) %>% 
  filter(!is.na(variable_name))
```

### Outside NYS producers

-   North Dakota: 434.05
-   Wyoming: 598.70
-   Colorado: 454.57
-   Texas: 400

```{r}

# Calculate mean and se from the data that we have
outside_ny <- tibble(
  location = c("North Dakota", "Wyoming", "Colorado", "Texas"), 
  cost_acre = c(434.05, 598.70, 454.57, 400)
)

# Calulate mean and standard error and include as vectors
mean <- outside_ny %>% 
  summarise(mean = mean(cost_acre)) %>% 
  pull()

se <- outside_ny %>% 
  summarise(sd = sd(cost_acre), 
            n = n(), 
            se = sd/sqrt(n)) %>% 
  pull(se)

production_cost <- production_cost %>% 
  add_row(
    variable_name = "cost_of_production_outsideNY", 
    production_cost_acre_mean = mean, 
    production_cost_acre_se = se)


# ADD in N/As for options not included 
names <- tibble(
  variable_name = 
    c("cost_of_production_drybean_more_mill_nonmwbe_conv",
      "cost_of_production_drybean_more_mill_mwbe_conv",
      "cost_of_production_drybean_less_mill_nonmwbe_conv", 
      "cost_of_production_drybean_less_mill_mwbe_conv", 
      "cost_of_production_drybean_more_mill_nonmwbe_org",
      "cost_of_production_drybean_more_mill_mwbe_org", 
      "cost_of_production_drybean_less_mill_nonmwbe_org", 
      "cost_of_production_drybean_less_mill_mwbe_org", 
      "cost_of_production_outsideNY")
)

# Join 
production_cost <- left_join(names, production_cost)

rm(names)

# Add in $ per hectare (1 hectare) = 2.471 acres)
production_cost <- production_cost %>% 
  mutate(
    production_cost_hectare_mean = production_cost_acre_mean*2.471, 
    production_cost_hectare_se = production_cost_acre_se*2.471
  )

write_csv(production_cost, "../data_processed/production_costs.csv")
```

### Soybeans 
We use Census of Agriculture data and keep only those producers with soybean sales. Because we only have soybean producers, then the total cost per acre is for soybeans only and we don't need to use a crop budget. 

In NY there are not enough farms in some categories. So we modify that NY data that we have up or down based on the national numbers. 

Conventional soybean producers in NY have 50% higher production costs than compared to the US. We take the numbers we have by scale, MWBE, organic and increase them by 50%. 

Crop budgets for comparison: 

-   [Ohio in 2022](https://farmoffice.osu.edu/farm-management/enterprise-budgets#2024)
  -   Conventional: 761/acre. 
  -   There is no data for organic until 2024, which is 946/acre. For comparison, conventional soy in 2024 was 754/acre. 
-   [Louisiana in 2022](https://www.lsuagcenter.com/articles/page1641147769855)
  -   454/acre
-   [Alabama in 2025](https://www.aces.edu/blog/topics/farm-management/soybean-enterprise-budget/)
  -   471/acre

```{r}

# Import fake data
soybeans <- read_xlsx(
  "../data_processed/coa_cost_per_acre_fake.xlsx", 
  sheet = "soybeans")

ny_inflation <- soybeans %>% 
  filter(sample=="NY") %>%
  pull(percent_diff_mean) 

# Inflate the means/se by the ny inflation number
soybeans <- soybeans %>% 
  select(mwbe_fct:se) %>%
  filter(mwbe_fct != "all") %>% 
  mutate(
    mean = mean + (mean*ny_inflation), 
    se = se + (se*ny_inflation)
  )
  
# Rename
soybeans <- soybeans %>% 
  mutate(
    variable_name = case_when(
      mwbe_fct=="Not MWBE" & 
        sales_class_agg == "GCFI $1M or more" & 
        organic_fct == "No organic sales" ~ 
        "cost_of_production_soy_more_mill_nonmwbe_conv", 
      mwbe_fct=="MWBE" & 
        sales_class_agg == "GCFI $1M or more" & 
        organic_fct == "No organic sales" ~
      "cost_of_production_soy_more_mill_mwbe_conv",
      mwbe_fct=="Not MWBE" & 
        sales_class_agg == "GCFI less than $1M" & 
        organic_fct == "No organic sales" ~ 
        "cost_of_production_soy_less_mill_nonmwbe_conv", 
      mwbe_fct=="MWBE" & 
        sales_class_agg == "GCFI less than $1M" & 
        organic_fct == "No organic sales" ~ 
        "cost_of_production_soy_less_mill_mwbe_conv", 
      mwbe_fct=="Not MWBE" & 
        sales_class_agg == "GCFI less than $1M" & 
        organic_fct == "Organic sales" ~
        "cost_of_production_soy_less_mill_nonmwbe_org", 
      mwbe_fct=="MWBE" & 
        sales_class_agg == "GCFI less than $1M" & 
        organic_fct == "Organic sales" ~
        "cost_of_production_soy_less_mill_mwbe_org"))

# add all names so blanks where no data
names <- tibble(
  variable_name = c(
    "cost_of_production_soy_more_mill_nonmwbe_conv", 
    "cost_of_production_soy_more_mill_mwbe_conv", 
    "cost_of_production_soy_less_mill_nonmwbe_conv", 
    "cost_of_production_soy_less_mill_mwbe_conv", 
    "cost_of_production_soy_more_mill_nonmwbe_org", 
    "cost_of_production_soy_more_mill_mwbe_org", 
    "cost_of_production_soy_less_mill_nonmwbe_org", 
    "cost_of_production_soy_less_mill_mwbe_org", 
    "cost_of_production_outsideNY")
)

# Join 
soybeans <- left_join(names, soybeans)

write_csv(soybeans, "../data_processed/soybeans.csv")
```

## Prices

We use [USDA NASS Crop values for Field and Miscellaneous Crops 2022-2024](https://www.nass.usda.gov/Publications/Todays_Reports/reports/cpvl0225.pdf). I could not find data for New York specifically, [2019-2021](https://downloads.usda.library.cornell.edu/usda-esmis/files/k35694332/gb19g8865/jd474051x/cpvl0222.pdf), [2017-2018](https://www.nass.usda.gov/Publications/Todays_Reports/reports/cpvl0220.pdf), and [2014-2016](https://downloads.usda.library.cornell.edu/usda-esmis/files/k35694332/5425kd763/st74dn630/CropValuSu-02-24-2017.pdf).

All data in price per cwt for dry edible beans and bushels for soybeans. Soybean data is based on soybeans for beans. For the model, they want everything in terms of killograms, so we convert to dollars per kg.

### NASS prices

```{r}
library(tidyverse)

# Write tibble for NASS price data
price_soybeans <- tibble(
  Crop = "Soybeans",
  Year = c(
    2014, 2015, 2016,
    2017, 2018,
    2019, 2020, 2021,
    2022, 2023, 2024),
  Price = c(
    10.10, 8.95, 9.50,
    9.33, 8.48, 
    8.57, 10.80, 13.00,
    14.20, 12.40, 10.10)
)

price_drybeans <- tibble(
  Crop = "Dry beans", 
  Year = c(
    2014, 2015, 2016,
    2017, 2018,
    2019, 2020, 2021,
    2022, 2023, 2024),
  Price = c(
    32.30, 27.30, 30.20,
    26.70, 25.40,
    31.80, 31.20, 39.20,
    40.50, 41.80, 38.00)
  )

# Combine into one file
price <- bind_rows(price_drybeans, price_soybeans)

rm(price_drybeans, price_soybeans)
```

### Convert to lbs/kgs.

All data in price per cwt for dry edible beans and bushels for soybeans. Soybean data is based on soybeans for beans.

We convert everything to price per killogram, as required by the model and price per lb.

**Dry beans** 1 cwt = 100 pounds 1 pound = 0.45359 kg 1 cwt = 45.359 kg

**Soybeans** 1 bushel of soybeans = 60 pounds (this is the standard weight) 1 pound = 0.45359 kg 1 bushel of soybeans = 60 Ã— 0.45359 = 27.216 kg

```{r}

# Dry beans- convert to price/kg
price <- price %>% 
  mutate(
    `Price per kg` = case_when(
      Crop == "Dry beans" ~ Price/45.359, 
      Crop == "Soybeans" ~ Price/27.216
    ), 
    `Price per lb` = case_when(
      Crop == "Dry beans" ~ Price/100, 
      Crop == "Soybeans" ~ Price/60
    )
  )

```

### PPI

We present data in 2024 prices used the St. Louis Fed, Producer Price Index by Commodity for [soybeans](https://fred.stlouisfed.org/series/WPU01830131) and [dry beans](https://fred.stlouisfed.org/series/WPU0113011).

The price index for dry beans starts in 2015, we use the 2015 value for 2014.

```{r}

# Import PPI
ppi_drybeans <- read_csv("../data_raw/WPU0113011_drybeans.csv") %>% 
  rename(
    drybeans = WPU0113011
  )

ppi_soybeans <- read_csv("../data_raw/WPU01830131_soybeans.csv") %>% 
  rename(
    soybeans = WPU01830131
  )

ppi <- left_join(ppi_soybeans, ppi_drybeans)
rm(ppi_drybeans, ppi_soybeans)

# Add year and drop data we don't need
ppi <- ppi %>% 
  mutate(
    year = year(observation_date)
  ) %>% 
  filter(
    year <2025 & year > 2013
  )

# Get average per year
ppi <- ppi %>% 
  group_by(year) %>% 
  summarise(drybeans = mean(drybeans, na.rm = TRUE), 
            soybeans = mean(soybeans)) %>% 
  ungroup

# Get index to convert to 2024 dollars
ppi <- ppi %>% 
  mutate(
    drybeans_index = drybeans[year == 2024]/drybeans, 
    soybeans_index = soybeans[year == 2024]/soybeans
  )
  
# Make 2014 index for dry beans equal to 2015
ppi <- ppi %>% 
  mutate(
    drybeans_index = case_when(
      is.nan(drybeans_index) ~ drybeans_index[year==2015], 
      TRUE ~ drybeans_index)
    )

# Put in correct format to join with price data
ppi <- ppi %>% 
  select(year, drybeans_index, soybeans_index) %>% 
  pivot_longer(
    cols = !year, 
    names_to = "Crop", 
    values_to = "ppi_index"
  ) %>% 
  mutate(
    Crop = case_when(
      Crop == "drybeans_index" ~ "Dry beans", 
      Crop == "soybeans_index" ~ "Soybeans")
    ) %>%
  rename(
    Year = year)

# Join price and ppi data
price <- price %>% 
  left_join(ppi)
rm(ppi)

# Convert prices to 2024 dollars
price <- price %>% 
  mutate(
    `Real price per kg (2024 dollars)` = `Price per kg` * ppi_index
  ) %>%
  rename(
    `Nominal price per kg` = `Price per kg`, 
    `Nomimal price per lb` = `Price per lb`) %>%
  select(-ppi_index)

# Round
price <- price %>% 
  mutate(across(`Nominal price per kg`:last_col(), 
                ~round(., 2))) %>% 
  ungroup()

commodity_price <- price %>% 
  filter(Year==2024 & Crop=="Dry beans") %>%
  pull(`Nomimal price per lb`)


```

### Differentiated price
We use data from the interviews to understand differentiated prices

NY Bean: Breakdown on a 50lb bag: Grower receives $52; Cleaner $5; $57 price out the door

```{r}

differentiated_price <- 52/50

```